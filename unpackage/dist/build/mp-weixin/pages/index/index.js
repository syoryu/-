(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{2584:function(t,e,n){"use strict";(function(t){var a=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(n("a34a")),o=a(n("c973"));n("0749");var r={data:function(){return{cropperShow:!1,width:250,height:250,avatarUrl:null,startTime:0,startX:0,startY:0,rotation:0,rm:"hue-rotate(0deg)",t:"rotateZ(0deg)",curBorderIdx:-1,canvasWidth:"300px",canvasHeight:"300px",titleHeight:null,screenHeight:null,screenWidth:null,showFadeIn:!1,txtList:0,blessing:null,knockX:null,knockY:null,list:[{link:"",id:"0",deg:0},{link:"../../static/1.png",id:"1",deg:-60},{link:"../../static/2.png",id:"2",deg:-120},{link:"../../static/3.png",id:"3",deg:-180},{link:"../../static/4.png",id:"4",deg:-240}]}},computed:{filterList:function(){return this.list.filter((function(t){return"0"!==t.id}))}},onLoad:function(){var e=this;this.$data.cropper=this.selectComponent("#image-cropper");var n=t.getMenuButtonBoundingClientRect();this.titleHeight=n.top,t.getSystemInfo({success:function(t){e.$data.ratio=t.windowWidth/750,e.screenHeight=t.screenHeight,e.screenWidth=t.screenWidth}})},onReady:function(){var e=this;t.getSystemInfo({success:function(t){console.log("系统信息",t),e.$data.ratio=t.windowWidth/750,e.screenHeight=t.screenHeight}}),setTimeout((function(){e.showFadeIn=!0}),150)},methods:{knock:function(t){var e=this;if(0==e.txtList){e.knockX=t.changedTouches[0].clientX,e.knockY=t.changedTouches[0].clientY,e.txtList+=1;var n=Math.floor(10*Math.random()+1);e.blessing="../../static/blessing/blessing".concat(n,".png"),setTimeout((function(){e.txtList-=1}),1e3)}},cropperFn:function(){this.cropperShow=!0,this.cropperShowGlobal=!0,this.$data.cropper.upload(),0==this.cropperShowGlobal&&(this.cropperShow=!1)},bindCrop:function(){var t=this,e=this;e.$data.cropper.getImg((function(n){e.cropperShow=!1,t.cropperShowGlobal=!1,e.avatarUrl=n.url}))},bindCancelCrop:function(){this.cropperShow=!1,this.cropperShowGlobal=!1},selectborder:function(t){this.curBorderIdx=t,this.rotation=this.list[t].deg,this.rm="hue-rotate(-"+this.rotation.toString()+"deg)",this.t="rotateZ("+this.rotation.toString()+"deg)"},toPrev:function(){1==this.curBorderIdx||0==this.curBorderIdx?(console.log("左边没有啦"),t.showToast({icon:"none",title:"左边没有啦"})):(this.curBorderIdx-=1,this.rotation=this.list[this.curBorderIdx].deg,this.rm="hue-rotate(-"+this.rotation.toString()+"deg)",this.t="rotateZ("+this.rotation.toString()+"deg)")},toNext:function(){4==this.curBorderIdx?(console.log("右边没有啦"),t.showToast({icon:"none",title:"右边没有啦"})):(this.curBorderIdx+=1,this.rotation=this.list[this.curBorderIdx].deg,this.rm="hue-rotate(-"+this.rotation.toString()+"deg)",this.t="rotateZ("+this.rotation.toString()+"deg)")},handleTouchstart:function(t){this.startTime=t.timeStamp,this.startX=t.changedTouches[0].clientX,this.startY=t.changedTouches[0].clientY},handleTouchend:function(t){var e=t.changedTouches[0].clientX,n=t.changedTouches[0].clientY;if(!(t.timeStamp-this.startTime>3e3)){var a="";Math.abs(e-this.startX)>10&&Math.abs(n-this.startY)<200&&(a=e-this.startX>0?"right":"left",console.log("direction",a),"right"===a?this.toPrev():"left"===a&&this.toNext())}},saveAvatar:function(){null==this.avatarUrl||""==this.avatarUrl?t.showToast({title:"请先点击获取头像",icon:"none",duration:2e3}):-1==this.curBorderIdx?t.showToast({title:"请选择一个边框",icon:"none"}):(t.showLoading({title:"正在生成头像",mask:!0}),this.drawImg())},drawImg:function(){var e=this,n=this;t.createSelectorQuery().select("#cropperCanvas").fields({node:!0,size:!0}).exec((function(a){n.$data.canvas=a[0].node,n.$data.ctx=n.$data.canvas.getContext("2d");var r=new Promise((function(e,a){t.getImageInfo({src:n.avatarUrl,success:function(t){return e(t)},fail:function(t){return a(t)}})})),s=new Promise((function(e,a){t.getImageInfo({src:"../../static/".concat(n.curBorderIdx,".png"),success:function(t){return e(t)},fail:function(t){return a(t)}})}));Promise.all([r,s]).then((function(a){n.$data.canvas.width=a[0].width/n.$data.ratio,n.$data.canvas.height=a[0].height/n.$data.ratio,n.$data.canvasWidth=a[0].height+"px",n.$data.canvasHeight=a[0].height+"px";var r=n.$data.canvas.createImage();r.src=a[0].path;var s=a[1].path;r.onload=function(){var a=n.$data.canvas.createImage();a.src="../../"+s,a.onload=function(){n.$data.ctx.drawImage(r,0,0,n.$data.canvas.width,n.$data.canvas.height),n.$data.ctx.drawImage(a,0,0,n.$data.canvas.width,n.$data.canvas.height);var s=1,c=200,h=1,d=e;(function e(n){return new Promise(function(){var a=(0,o.default)(i.default.mark((function a(o,r){return i.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:setTimeout((function(){t.canvasToTempFilePath({x:0,y:0,width:n.$data.canvas.width,height:n.$data.canvas.height,destWidth:2*n.$data.canvas.width,destHeight:2*n.$data.canvas.height,canvas:n.$data.canvas,quality:h,success:function(e){console.log("√生成成功，尝试次数:"+s+",延迟:"+c+",画质:"+h,e),console.log("[生成图片路径]",e.tempFilePath),t.hideLoading(),o(e.tempFilePath)},fail:function(a){t.hideLoading(),s<=5?(s+=1,c+=100,h-=.1,e(n)):(console.log("×生成失败，尝试次数:"+s+",延迟:"+c+",画质:"+h,a),r("绘制失败"),t.showToast({mask:!0,icon:"none",title:"绘制失败，请重新上传"}))}})}),c);case 1:case"end":return a.stop()}}),a)})));return function(t,e){return a.apply(this,arguments)}}())})(d).then((function(e){t.hideLoading(),t.saveImageToPhotosAlbum({filePath:e,success:function(e){t.showToast({title:"已保存到手机相册",icon:"none"})},fail:function(e){t.showToast({title:"取消保存",icon:"none"})}})})).catch((function(e){t.showToast({title:e,icon:"none"})}))}}}))}))}}};e.default=r}).call(this,n("543d")["default"])},4670:function(t,e,n){"use strict";var a=n("62db"),i=n.n(a);i.a},4756:function(t,e,n){"use strict";n.r(e);var a=n("ee52"),i=n("c2bd");for(var o in i)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(o);n("4670");var r=n("f0c5"),s=Object(r["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],void 0);e["default"]=s.exports},"62db":function(t,e,n){},"997e":function(t,e,n){"use strict";(function(t){var e=n("4ea4");n("8494");e(n("66fd"));var a=e(n("4756"));wx.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n("543d")["createPage"])},c2bd:function(t,e,n){"use strict";n.r(e);var a=n("2584"),i=n.n(a);for(var o in a)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(o);e["default"]=i.a},ee52:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){}));var a=function(){var t=this.$createElement;this._self._c},i=[]}},[["997e","common/runtime","common/vendor"]]]);