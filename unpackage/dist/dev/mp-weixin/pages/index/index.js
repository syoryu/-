(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{33:function(t,e,n){"use strict";(function(t,e){var i=n(4);n(26);i(n(25));var a=i(n(34));t.__webpack_require_UNI_MP_PLUGIN__=n,e(a.default)}).call(this,n(1)["default"],n(2)["createPage"])},34:function(t,e,n){"use strict";n.r(e);var i=n(35),a=n(37);for(var o in a)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(o);n(45);var r,s=n(32),c=Object(s["default"])(a["default"],i["render"],i["staticRenderFns"],!1,null,null,null,!1,i["components"],r);c.options.__file="pages/index/index.vue",e["default"]=c.exports},35:function(t,e,n){"use strict";n.r(e);var i=n(36);n.d(e,"render",(function(){return i["render"]})),n.d(e,"staticRenderFns",(function(){return i["staticRenderFns"]})),n.d(e,"recyclableRender",(function(){return i["recyclableRender"]})),n.d(e,"components",(function(){return i["components"]}))},36:function(t,e,n){"use strict";var i;n.r(e),n.d(e,"render",(function(){return a})),n.d(e,"staticRenderFns",(function(){return r})),n.d(e,"recyclableRender",(function(){return o})),n.d(e,"components",(function(){return i}));var a=function(){var t=this,e=t.$createElement;t._self._c},o=!1,r=[];a._withStripped=!0},37:function(t,e,n){"use strict";n.r(e);var i=n(38),a=n.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(o);e["default"]=a.a},38:function(t,e,n){"use strict";(function(t){var i=n(4),a=n(13);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(n(39)),r=i(n(41));n(42);var s=i(n(43)),c=h(n(44));function u(t){if("function"!==typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(u=function(t){return t?n:e})(t)}function h(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==a(t)&&"function"!==typeof t)return{default:t};var n=u(e);if(n&&n.has(t))return n.get(t);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if("default"!==r&&Object.prototype.hasOwnProperty.call(t,r)){var s=o?Object.getOwnPropertyDescriptor(t,r):null;s&&(s.get||s.set)?Object.defineProperty(i,r,s):i[r]=t[r]}return i.default=t,n&&n.set(t,i),i}var d={data:function(){return{confettiShow:"-999",cropperShow:!1,width:250,height:250,avatarUrl:null,startTime:0,startX:0,startY:0,rotation:0,rm:"hue-rotate(0deg)",t:"rotateZ(0deg)",curBorderIdx:-1,canvasWidth:"300px",canvasHeight:"300px",titleHeight:null,screenHeight:null,screenWidth:null,showFadeIn:!1,txtList:[],num:0,blessing:null,knockX:null,knockY:null,reuploadTag:!1,list:[{link:"",id:"0",deg:0},{link:"../../static/1.png",id:"1",deg:-60},{link:"../../static/2.png",id:"2",deg:-120},{link:"../../static/3.png",id:"3",deg:-180},{link:"../../static/4.png",id:"4",deg:-240}]}},computed:{filterList:function(){return this.list.filter((function(t){return"0"!==t.id}))}},onLoad:function(){var e=this;this.$data.cropper=this.selectComponent("#image-cropper");var n=t.getMenuButtonBoundingClientRect();this.titleHeight=n.top,console.log("this.titleHeight",this.titleHeight),t.getSystemInfo({success:function(t){e.$data.ratio=t.windowWidth/750,e.screenHeight=t.screenHeight,e.screenWidth=t.screenWidth,console.log("screenWidth",e.screenWidth)}})},onReady:function(){var e=this;t.getSystemInfo({success:function(t){e.$data.ratio=t.windowWidth/750,e.screenHeight=t.screenHeight}}),setTimeout((function(){e.showFadeIn=!0}),150),this.txtList=[],this.num=0},onShow:function(){this.txtList=[],this.num=0},methods:{init:function(){var e=this,n=this;t.createSelectorQuery().selectAll("#c1").node((function(t){var i=t[0].node,a=i.getContext("2d");i.width=64*n.screenWidth/75,i.height=64*n.screenWidth/75,s.default.setup(i),e.ani=s.default.loadAnimation({loop:!1,autoplay:!0,animationData:c,rendererSettings:{context:a}}),e._inited=!0})).exec()},play:function(){this.ani.play()},pause:function(){this.ani.pause()},knock:function(t){var e=t.changedTouches[0].clientX,n=t.changedTouches[0].clientY;this.num+=1;var i=Math.floor(10*Math.random()+1),a=JSON.parse(JSON.stringify(this.txtList));a.push({img:"../../static/blessing/blessing".concat(i,".png"),id:this.num,knockX:e,knockY:n});var o=15;a.length===o&&(a.reverse(),a.length=a.length-(o-5),a.reverse()),this.txtList=a,console.log(this.num,this.txtList)},cropperFn:function(){var t=this;this.cropperShow=!0,this.cropperShowGlobal=!0,null==this.avatarUrl&&(t.$data.cropper.upload(),this.reuploadTag=!0),0==this.cropperShowGlobal&&(this.cropperShow=!1)},reupload:function(){var t=this;this.cropperShow=!0,this.cropperShowGlobal=!0,t.$data.cropper.upload(),0==this.cropperShowGlobal&&(this.cropperShow=!1)},bindCrop:function(){var t=this,e=this;e.$data.cropper.getImg((function(n){e.cropperShow=!1,t.cropperShowGlobal=!1,e.avatarUrl=n.url}))},bindCancelCrop:function(){this.cropperShow=!1,this.cropperShowGlobal=!1},selectborder:function(t){this.curBorderIdx=t,this.rotation=this.list[t].deg,this.rm="hue-rotate(-"+this.rotation.toString()+"deg)",this.t="rotateZ("+this.rotation.toString()+"deg)"},toPrev:function(){1==this.curBorderIdx||0==this.curBorderIdx?(console.log("左边没有啦"),t.showToast({icon:"none",title:"左边没有啦"})):(this.curBorderIdx-=1,this.rotation=this.list[this.curBorderIdx].deg,this.rm="hue-rotate(-"+this.rotation.toString()+"deg)",this.t="rotateZ("+this.rotation.toString()+"deg)")},toNext:function(){4==this.curBorderIdx?(console.log("右边没有啦"),t.showToast({icon:"none",title:"右边没有啦"})):(this.curBorderIdx+=1,this.rotation=this.list[this.curBorderIdx].deg,this.rm="hue-rotate(-"+this.rotation.toString()+"deg)",this.t="rotateZ("+this.rotation.toString()+"deg)")},handleTouchstart:function(t){this.startTime=t.timeStamp,this.startX=t.changedTouches[0].clientX,this.startY=t.changedTouches[0].clientY},handleTouchend:function(t){var e=t.changedTouches[0].clientX,n=t.changedTouches[0].clientY;if(!(t.timeStamp-this.startTime>3e3)){var i="";Math.abs(e-this.startX)>10&&Math.abs(n-this.startY)<200&&(i=e-this.startX>0?"right":"left",console.log("direction",i),"right"===i?this.toPrev():"left"===i&&this.toNext())}},saveAvatar:function(){null==this.avatarUrl||""==this.avatarUrl?t.showToast({title:"请先点击获取头像",icon:"none",duration:2e3}):-1==this.curBorderIdx?t.showToast({title:"请选择一个边框",icon:"none"}):(t.showLoading({title:"正在生成头像",mask:!0}),this.drawImg())},drawImg:function(){var e=this,n=this;t.createSelectorQuery().select("#cropperCanvas").fields({node:!0,size:!0}).exec((function(i){n.$data.canvas=i[0].node,n.$data.ctx=n.$data.canvas.getContext("2d");var a=new Promise((function(e,i){t.getImageInfo({src:n.avatarUrl,success:function(t){return e(t)},fail:function(t){return i(t)}})})),s=new Promise((function(e,i){t.getImageInfo({src:"../../static/".concat(n.curBorderIdx,".png"),success:function(t){return e(t)},fail:function(t){return i(t)}})}));Promise.all([a,s]).then((function(i){n.$data.canvas.width=i[0].width/n.$data.ratio,n.$data.canvas.height=i[0].height/n.$data.ratio,n.$data.canvasWidth=i[0].height+"px",n.$data.canvasHeight=i[0].height+"px";var a=n.$data.canvas.createImage();a.src=i[0].path;var s=i[1].path;a.onload=function(){var i=n.$data.canvas.createImage();i.src="../../"+s,i.onload=function(){n.$data.ctx.drawImage(a,0,0,n.$data.canvas.width,n.$data.canvas.height),n.$data.ctx.drawImage(i,0,0,n.$data.canvas.width,n.$data.canvas.height);var s=1,c=200,u=1,h=e;function d(e){return new Promise(function(){var n=(0,r.default)(o.default.mark((function n(i,a){return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:setTimeout((function(){t.canvasToTempFilePath({x:0,y:0,width:e.$data.canvas.width,height:e.$data.canvas.height,destWidth:2*e.$data.canvas.width,destHeight:2*e.$data.canvas.height,canvas:e.$data.canvas,quality:u,success:function(e){console.log("√生成成功，尝试次数:"+s+",延迟:"+c+",画质:"+u,e),console.log("[生成图片路径]",e.tempFilePath),t.hideLoading(),i(e.tempFilePath)},fail:function(n){t.hideLoading(),s<=5?(s+=1,c+=100,u-=.1,d(e)):(console.log("×生成失败，尝试次数:"+s+",延迟:"+c+",画质:"+u,n),a("绘制失败"),t.showToast({mask:!0,icon:"none",title:"绘制失败，请重新上传"}))}})}),c);case 1:case"end":return n.stop()}}),n)})));return function(t,e){return n.apply(this,arguments)}}())}d(h).then((function(e){t.hideLoading(),t.saveImageToPhotosAlbum({filePath:e,success:function(e){h.confettiShow="999",h.init(),t.showToast({title:"已保存到手机相册",icon:"none"}),setTimeout((function(){h.confettiShow="-999"}),2e3)},fail:function(e){t.showToast({title:"取消保存",icon:"none"})}})})).catch((function(e){t.showToast({title:e,icon:"none"})}))}}}))}))}}};e.default=d}).call(this,n(2)["default"])},45:function(t,e,n){"use strict";n.r(e);var i=n(46),a=n.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(o);e["default"]=a.a},46:function(t,e,n){}},[[33,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/index/index.js.map